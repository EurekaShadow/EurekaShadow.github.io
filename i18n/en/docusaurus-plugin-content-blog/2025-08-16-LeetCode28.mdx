---
slug: LeetCode28
title: æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡
authors: eurekaX
tags: [å­—ç¬¦ä¸²]
---
import { Highlight, Keyword, Light, B1, B2, B3, BH3, B3W, MyColor} from '@site/src/components/ForMDX';


### <B2>[åŠ›æ‰£é¢è¯•ç»å…¸â€”â€”28é¢˜](https://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string/description/?envType=study-plan-v2&envId=top-interview-150 "åŠ›æ‰£")</B2>

<!-- truncate -->


### ğŸ’¡ å‚è€ƒä»£ç ï¼š

```c
/**
 * åœ¨haystackå­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾needleå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªåŒ¹é…ä½ç½®
 * @param haystack ä¸»å­—ç¬¦ä¸²
 * @param needle è¦æŸ¥æ‰¾çš„å­å­—ç¬¦ä¸²
 * @return è¿”å›ç¬¬ä¸€æ¬¡åŒ¹é…çš„ç´¢å¼•ï¼Œå¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å›-1
 */
int strStr(char* haystack, char* needle) {
    // è¾¹ç•Œæ¡ä»¶å¤„ç†
    if (needle == NULL || *needle == '\0') {
        return 0;  // ç©ºå­—ç¬¦ä¸²åœ¨ä»»ä½•å­—ç¬¦ä¸²çš„ç´¢å¼•0å¤„åŒ¹é…
    }
    
    if (haystack == NULL || *haystack == '\0') {
        return -1; // ä¸»å­—ç¬¦ä¸²ä¸ºç©ºä½†è¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²éç©ºï¼Œè¿”å›-1
    }
    
    int hLen = strlen(haystack);  // ä¸»å­—ç¬¦ä¸²é•¿åº¦
    int nLen = strlen(needle);    // å­å­—ç¬¦ä¸²é•¿åº¦
    
    // å¦‚æœå­å­—ç¬¦ä¸²æ¯”ä¸»å­—ç¬¦ä¸²é•¿ï¼Œä¸å¯èƒ½åŒ¹é…
    if (nLen > hLen) {
        return -1;
    }
    
    // æ„å»ºnextæ•°ç»„ï¼ˆKMPç®—æ³•çš„æ ¸å¿ƒï¼‰
    int* next = (int*)malloc(sizeof(int) * nLen);
    next[0] = 0;  // ç¬¬ä¸€ä¸ªå­—ç¬¦çš„æœ€é•¿ç›¸ç­‰å‰åç¼€é•¿åº¦ä¸º0
    int j = 0;    // å‰ç¼€æœ«å°¾ç´¢å¼•
    
    // æ„é€ nextæ•°ç»„
    for (int i = 1; i < nLen; i++) {
        // å½“å‰åç¼€ä¸åŒ¹é…æ—¶ï¼Œå›é€€åˆ°å‰ä¸€ä¸ªä½ç½®çš„nextå€¼
        while (j > 0 && needle[i] != needle[j]) {
            j = next[j - 1];
        }
        // å¦‚æœå½“å‰å­—ç¬¦åŒ¹é…ï¼Œå‰ç¼€é•¿åº¦åŠ 1
        if (needle[i] == needle[j]) {
            j++;
        }
        next[i] = j;  // è®°å½•å½“å‰ä½ç½®çš„æœ€é•¿ç›¸ç­‰å‰åç¼€é•¿åº¦
    }
    
    // KMPåŒ¹é…è¿‡ç¨‹
    j = 0;  // needleçš„ç´¢å¼•
    for (int i = 0; i < hLen; i++) {
        // å½“å­—ç¬¦ä¸åŒ¹é…æ—¶ï¼Œæ ¹æ®nextæ•°ç»„å›é€€
        while (j > 0 && haystack[i] != needle[j]) {
            j = next[j - 1];
        }
        // å¦‚æœå­—ç¬¦åŒ¹é…ï¼Œç§»åŠ¨needleçš„æŒ‡é’ˆ
        if (haystack[i] == needle[j]) {
            j++;
        }
        // å¦‚æœneedleå·²ç»å®Œå…¨åŒ¹é…ï¼Œè¿”å›åŒ¹é…èµ·å§‹ä½ç½®
        if (j == nLen) {
            free(next);  // é‡Šæ”¾å†…å­˜
            return i - nLen + 1;
        }
    }
    
    free(next);  // é‡Šæ”¾å†…å­˜
    return -1;   // æœªæ‰¾åˆ°åŒ¹é…
}
```

### ğŸ“– æ€»ç»“ï¼š

<details>
<summary>ç‚¹å‡»å±•å¼€é¢˜ç›®æ€»ç»“</summary>
# ğŸ¤” æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡

---

## 1ï¸âƒ£ é¢˜ç›®æ ¸å¿ƒä¿¡æ¯

ğŸ¯ **åŠŸèƒ½æè¿°**ï¼šåœ¨ä¸»å­—ç¬¦ä¸²(haystack)ä¸­æŸ¥æ‰¾å­å­—ç¬¦ä¸²(needle)ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œè‹¥ä¸å­˜åœ¨åˆ™è¿”å›-1

ğŸ“¥ **è¾“å…¥è¾“å‡º**ï¼š
- **è¾“å…¥**ï¼š
  - `haystack`ï¼šä¸»å­—ç¬¦ä¸²ï¼Œè¢«æœç´¢çš„å­—ç¬¦ä¸²
  - `needle`ï¼šæ¨¡å¼å­—ç¬¦ä¸²ï¼Œéœ€è¦æŸ¥æ‰¾çš„å­å­—ç¬¦ä¸²
- **è¾“å‡º**ï¼šè¿”å›`needle`åœ¨`haystack`ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ä½ç½®ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›-1

---

## 2ï¸âƒ£ å®ç°åŸç†

ğŸ’¡ **æ ¸å¿ƒæ€è·¯**ï¼šä½¿ç”¨KMP(Knuth-Morris-Pratt)å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼Œé€šè¿‡é¢„å¤„ç†æ¨¡å¼ä¸²æ„å»ºnextæ•°ç»„æ¥é¿å…ä¸å¿…è¦çš„å­—ç¬¦æ¯”è¾ƒ

ğŸ“‹ **å®ç°æ­¥éª¤**ï¼š
1. å¤„ç†è¾¹ç•Œæƒ…å†µï¼šç©ºå­—ç¬¦ä¸²ã€ä¸»ä¸²ä¸ºç©ºç­‰æƒ…å†µ
2. æ„å»ºnextæ•°ç»„ï¼šè®°å½•æ¨¡å¼ä¸²ä¸­æ¯ä¸ªä½ç½®çš„æœ€é•¿ç›¸ç­‰å‰åç¼€é•¿åº¦
3. ä½¿ç”¨KMPç®—æ³•è¿›è¡ŒåŒ¹é…ï¼šåˆ©ç”¨nextæ•°ç»„é¿å…ä¸»ä¸²æŒ‡é’ˆå›æº¯
4. è¿”å›åŒ¹é…ç»“æœï¼šæ‰¾åˆ°åŒ¹é…åˆ™è¿”å›èµ·å§‹ä½ç½®ï¼Œå¦åˆ™è¿”å›-1

---

## 3ï¸âƒ£ å…³é”®ç‚¹è§£æ

### ğŸ¯ ä»£ç æŠ€å·§
- **KMPç®—æ³•åº”ç”¨**ï¼šé€šè¿‡æ„å»ºnextæ•°ç»„å®ç°é«˜æ•ˆçš„å­—ç¬¦ä¸²åŒ¹é…
- **åŒæŒ‡é’ˆæŠ€æœ¯**ï¼šä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«éå†ä¸»ä¸²å’Œæ¨¡å¼ä¸²
- **çŠ¶æ€å›é€€ä¼˜åŒ–**ï¼šåˆ©ç”¨nextæ•°ç»„å®ç°åŒ¹é…å¤±è´¥æ—¶çš„æ™ºèƒ½å›é€€ï¼Œé¿å…é‡å¤æ¯”è¾ƒ

## 4ï¸âƒ£ ä½¿ç”¨åœºæ™¯

### âœ… é€‚ç”¨æƒ…å†µï¼š
- åœ¨å¤§æ–‡æœ¬ä¸­æŸ¥æ‰¾ç‰¹å®šå­ä¸²çš„ä½ç½®
- éœ€è¦é«˜æ•ˆå­—ç¬¦ä¸²åŒ¹é…çš„åœºæ™¯
- æ–‡æœ¬ç¼–è¾‘å™¨çš„æŸ¥æ‰¾åŠŸèƒ½å®ç°

### âš ï¸ å‰ææ¡ä»¶ï¼š
- è¾“å…¥å‚æ•°ä¸ºæœ‰æ•ˆçš„Cé£æ ¼å­—ç¬¦ä¸²
- å­—ç¬¦ä¸²ä»¥'\0'ç»“å°¾

## 5ï¸âƒ£ å¤æ‚åº¦åˆ†æ

- â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n + m)ï¼Œå…¶ä¸­næ˜¯ä¸»ä¸²é•¿åº¦ï¼Œmæ˜¯æ¨¡å¼ä¸²é•¿åº¦ï¼Œé¿å…äº†æš´åŠ›ç®—æ³•çš„O(n*m)å¤æ‚åº¦

- ğŸ’¾ ç©ºé—´å¤æ‚åº¦ï¼šO(m)ï¼Œä¸»è¦ç”¨äºå­˜å‚¨nextæ•°ç»„

## 6ï¸âƒ£ æ³¨æ„äº‹é¡¹

### ğŸš© è¾¹ç•Œæƒ…å†µï¼š
- needleä¸ºç©ºå­—ç¬¦ä¸²æ—¶åº”è¿”å›0
- haystackä¸ºç©ºå­—ç¬¦ä¸²ä½†needleéç©ºæ—¶åº”è¿”å›-1
- needleé•¿åº¦å¤§äºhaystackæ—¶ç›´æ¥è¿”å›-1

### ğŸ’¥ æ˜“é”™ç‚¹ï¼š
- nextæ•°ç»„çš„æ„å»ºé€»è¾‘å®¹æ˜“å‡ºé”™ï¼Œç‰¹åˆ«æ˜¯å›é€€æ¡ä»¶çš„åˆ¤æ–­
- åŒ¹é…æˆåŠŸåçš„è¿”å›ç´¢å¼•è®¡ç®—å®¹æ˜“é”™è¯¯ï¼Œåº”è¿”å›i - nLen + 1
- å†…å­˜ç®¡ç†éœ€è¦æ³¨æ„ï¼Œä½¿ç”¨å®Œnextæ•°ç»„åéœ€è¦é‡Šæ”¾å†…å­˜

## 7ï¸âƒ£ æ³¨æ„äº‹é¡¹

### KMPç®—æ³•åŸç†ç®€è¿°

`KMPç®—æ³•`æ˜¯ä¸€ç§æ”¹è¿›çš„å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å½“å­—ç¬¦åŒ¹é…å¤±è´¥æ—¶ï¼Œåˆ©ç”¨å·²ç»åŒ¹é…çš„éƒ¨åˆ†ä¿¡æ¯ï¼Œå°½å¯èƒ½åœ°è·³è¿‡ä¸€äº›ä¸å¿…è¦çš„æ¯”è¾ƒã€‚

### ç¬¬ä¸€æ­¥ï¼šè¾¹ç•Œæ¡ä»¶å¤„ç†
```
if (needle == NULL || *needle == '\0') {
    return 0;  // ç©ºå­—ç¬¦ä¸²åœ¨ä»»ä½•å­—ç¬¦ä¸²çš„ç´¢å¼•0å¤„åŒ¹é…
}

if (haystack == NULL || *haystack == '\0') {
    return -1; // ä¸»å­—ç¬¦ä¸²ä¸ºç©ºä½†è¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²éç©ºï¼Œè¿”å›-1
}
```
è¿™éƒ¨åˆ†å¤„ç†ç‰¹æ®Šæƒ…å†µï¼š

- å¦‚æœè¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²ä¸ºç©ºï¼Œåˆ™åœ¨ä»»ä½•å­—ç¬¦ä¸²çš„ç¬¬0ä¸ªä½ç½®éƒ½èƒ½æ‰¾åˆ°å®ƒ
- å¦‚æœä¸»å­—ç¬¦ä¸²ä¸ºç©ºä½†è¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²ä¸ä¸ºç©ºï¼Œåˆ™è‚¯å®šæ‰¾ä¸åˆ°

### ç¬¬äºŒæ­¥ï¼šè·å–å­—ç¬¦ä¸²é•¿åº¦å¹¶æ¯”è¾ƒ
```
int hLen = strlen(haystack);  // ä¸»å­—ç¬¦ä¸²é•¿åº¦
int nLen = strlen(needle);    // å­å­—ç¬¦ä¸²é•¿åº¦

if (nLen > hLen) {
    return -1;
}
```
å¦‚æœè¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²æ¯”ä¸»å­—ç¬¦ä¸²è¿˜é•¿ï¼Œé‚£è‚¯å®šæ‰¾ä¸åˆ°ã€‚

### ç¬¬ä¸‰æ­¥ï¼šæ„å»ºnextæ•°ç»„ï¼ˆKMPç®—æ³•çš„æ ¸å¿ƒï¼‰
```
int* next = (int*)malloc(sizeof(int) * nLen);
next[0] = 0;  // ç¬¬ä¸€ä¸ªå­—ç¬¦çš„æœ€é•¿ç›¸ç­‰å‰åç¼€é•¿åº¦ä¸º0
int j = 0;    // å‰ç¼€æœ«å°¾ç´¢å¼•

// æ„é€ nextæ•°ç»„
for (int i = 1; i < nLen; i++) {
    // å½“å‰åç¼€ä¸åŒ¹é…æ—¶ï¼Œå›é€€åˆ°å‰ä¸€ä¸ªä½ç½®çš„nextå€¼
    while (j > 0 && needle[i] != needle[j]) {
        j = next[j - 1];
    }
    // å¦‚æœå½“å‰å­—ç¬¦åŒ¹é…ï¼Œå‰ç¼€é•¿åº¦åŠ 1
    if (needle[i] == needle[j]) {
        j++;
    }
    next[i] = j;  // è®°å½•å½“å‰ä½ç½®çš„æœ€é•¿ç›¸ç­‰å‰åç¼€é•¿åº¦
}
```
æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“ä¾‹å­æ¥ç†è§£nextæ•°ç»„çš„æ„å»ºè¿‡ç¨‹ã€‚å‡è®¾`needle = "ababa"`ï¼š

| i | needle[i] | j | next[i] | è¯´æ˜ |
|---|-----------|---|---------|------|
| 0 | a | 0 | 0 | åˆå§‹å€¼ |
| 1 | b | 0 | 0 | 'a' != 'b'ï¼Œjä¿æŒ0 |
| 2 | a | 1 | 1 | 'b' != 'a'ï¼Œjå›é€€åˆ°next[0]=0ï¼Œç„¶å'a' == 'a'ï¼Œj=1 |
| 3 | b | 2 | 2 | 'a' != 'b'ï¼Œjå›é€€åˆ°next[1]=0ï¼Œç„¶å'b' == 'b'ï¼Œj=1ï¼Œå†'a' == 'a'ï¼Œj=2 |
| 4 | a | 3 | 3 | åŒä¸Šé€»è¾‘ï¼Œj=3 |

æ‰€ä»¥`next = [0, 0, 1, 2, 3]`

### ç¬¬å››æ­¥ï¼šKMPåŒ¹é…è¿‡ç¨‹
```
j = 0;  // needleçš„ç´¢å¼•
for (int i = 0; i < hLen; i++) {
    // å½“å­—ç¬¦ä¸åŒ¹é…æ—¶ï¼Œæ ¹æ®nextæ•°ç»„å›é€€
    while (j > 0 && haystack[i] != needle[j]) {
        j = next[j - 1];
    }
    // å¦‚æœå­—ç¬¦åŒ¹é…ï¼Œç§»åŠ¨needleçš„æŒ‡é’ˆ
    if (haystack[i] == needle[j]) {
        j++;
    }
    // å¦‚æœneedleå·²ç»å®Œå…¨åŒ¹é…ï¼Œè¿”å›åŒ¹é…èµ·å§‹ä½ç½®
    if (j == nLen) {
        free(next);
        return i - nLen + 1;
    }
}
```
ç¤ºä¾‹1ï¼š`haystack = "sadbutsad", needle = "sad"`

é¦–å…ˆæ„å»ºçš„nextæ•°ç»„ä¸º[0, 0, 0]ï¼ˆå› ä¸º"sad"ä¸­æ²¡æœ‰é‡å¤çš„å‰åç¼€ï¼‰

| i | haystack[i] | j | needle[j] | åŒ¹é…æƒ…å†µ | è¯´æ˜ |
|---|-------------|---|-----------|----------|------|
| 0 | s | 0 | s | åŒ¹é… | j++ â†’ 1 |
| 1 | a | 1 | a | åŒ¹é… | j++ â†’ 2 |
| 2 | d | 2 | d | åŒ¹é… | j++ â†’ 3 |
| - | - | 3 | - | - | j==nLenï¼ŒåŒ¹é…æˆåŠŸï¼Œè¿”å› 2-3+1=0 |

æ‰€ä»¥è¿”å›ç´¢å¼•0ã€‚

ç¤ºä¾‹2ï¼š`haystack = "leetcode", needle = "leeto"`

æ„å»ºçš„nextæ•°ç»„ä¸º[0, 0, 0, 0, 0]ï¼ˆå› ä¸º"leeto"ä¸­æ²¡æœ‰é‡å¤å‰åç¼€ï¼‰

| i | haystack[i] | j | needle[j] | åŒ¹é…æƒ…å†µ | è¯´æ˜ |
|---|-------------|---|-----------|----------|------|
| 0 | l | 0 | l | åŒ¹é… | j++ â†’ 1 |
| 1 | e | 1 | e | åŒ¹é… | j++ â†’ 2 |
| 2 | e | 2 | e | åŒ¹é… | j++ â†’ 3 |
| 3 | t | 3 | t | åŒ¹é… | j++ â†’ 4 |
| 4 | c | 4 | o | ä¸åŒ¹é… | jå›é€€åˆ°next[3]=0ï¼Œä»ä¸åŒ¹é…ï¼Œjä¿æŒ0 |
| 5 | o | 0 | l | ä¸åŒ¹é… | jä¿æŒ0 |
| 6 | d | 0 | l | ä¸åŒ¹é… | jä¿æŒ0 |
| 7 | e | 0 | l | ä¸åŒ¹é… | jä¿æŒ0 |

æ•´ä¸ªè¿‡ç¨‹jä»æœªè¾¾åˆ°nLen=5ï¼Œæ‰€ä»¥è¿”å›-1ã€‚

### KMPç®—æ³•çš„ä¼˜åŠ¿

ç›¸æ¯”æš´åŠ›åŒ¹é…ç®—æ³•ï¼ŒKMPç®—æ³•çš„ä¼˜åŠ¿åœ¨äºï¼š

1.æ—¶é—´å¤æ‚åº¦ä»O(n*m)é™ä½åˆ°O(n+m)

2.å½“å‘ç”Ÿä¸åŒ¹é…æ—¶ï¼Œä¸»ä¸²çš„æŒ‡é’ˆä¸ä¼šå›æº¯ï¼Œé¿å…äº†é‡å¤æ¯”è¾ƒ

3.åˆ©ç”¨å·²åŒ¹é…çš„ä¿¡æ¯ï¼Œé€šè¿‡nextæ•°ç»„å†³å®šæ¨¡å¼ä¸²åº”è¯¥ç§»åŠ¨å¤šå°‘ä½

è¿™å°±æ˜¯KMPç®—æ³•è§£å†³å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜çš„å®Œæ•´è¿‡ç¨‹ã€‚

è¿™ä¸ª `KMPç®—æ³•` æˆ‘è‡³ä»Šä¸ç†è§£ï¼ï¼ˆ20250816ï¼‰

</details>
