---
slug: LeetCode138
title: éšæœºé“¾è¡¨çš„å¤åˆ¶
authors: eurekaX
tags: [å“ˆå¸Œè¡¨,é“¾è¡¨]
---
import { Highlight, Keyword, Light, B1, B2, B3, BH3, B3W, MyColor} from '@site/src/components/ForMDX';


### <B2>[åŠ›æ‰£é¢è¯•ç»å…¸â€”â€”138é¢˜](https://leetcode.cn/problems/copy-list-with-random-pointer/description/?envType=study-plan-v2&envId=top-interview-150 "åŠ›æ‰£")</B2>

<!-- truncate -->


### ğŸ’¡ å‚è€ƒä»£ç ï¼š

```c
/**
 * Definition for a Node.
 * struct Node {
 *     int val;
 *     struct Node *next;
 *     struct Node *random;
 * };
 */

struct Node* copyRandomList(struct Node* head) {
    // å¦‚æœè¾“å…¥ä¸ºç©ºï¼Œç›´æ¥è¿”å›ç©º
    if (head == NULL) {
        return NULL;
    }

    // ç¬¬ä¸€æ­¥ï¼šå¤åˆ¶æ¯ä¸ªèŠ‚ç‚¹å¹¶æ’å…¥åˆ°åŸèŠ‚ç‚¹åé¢
    // åŸé“¾è¡¨: 1 -> 2 -> 3
    // å¤åˆ¶å: 1 -> 1' -> 2 -> 2' -> 3 -> 3'
    struct Node* curr = head;
    while (curr != NULL) {
        // åˆ›å»ºæ–°èŠ‚ç‚¹
        struct Node* newNode = (struct Node*)malloc(sizeof(struct Node));
        newNode->val = curr->val;
        // å°†æ–°èŠ‚ç‚¹æ’å…¥åˆ°å½“å‰èŠ‚ç‚¹å’Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¹‹é—´
        newNode->next = curr->next;
        curr->next = newNode;
        // ç§»åŠ¨åˆ°åŸå§‹é“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆè·³è¿‡åˆšæ’å…¥çš„å¤åˆ¶èŠ‚ç‚¹ï¼‰
        curr = newNode->next;
    }

    // ç¬¬äºŒæ­¥ï¼šè®¾ç½®å¤åˆ¶èŠ‚ç‚¹çš„ random æŒ‡é’ˆ
    curr = head;
    while (curr != NULL) {
        // å¤åˆ¶èŠ‚ç‚¹æ˜¯å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
        struct Node* copyNode = curr->next;
        // å¦‚æœåŸèŠ‚ç‚¹çš„ random æŒ‡é’ˆä¸ºç©ºï¼Œåˆ™å¤åˆ¶èŠ‚ç‚¹çš„ random ä¹Ÿä¸ºç©º
        // å¦åˆ™ï¼Œå¤åˆ¶èŠ‚ç‚¹çš„ random åº”è¯¥æŒ‡å‘åŸèŠ‚ç‚¹ random æŒ‡é’ˆæŒ‡å‘èŠ‚ç‚¹çš„å¤åˆ¶èŠ‚ç‚¹
        // åŸèŠ‚ç‚¹ random æŒ‡å‘çš„èŠ‚ç‚¹çš„å¤åˆ¶èŠ‚ç‚¹å°±æ˜¯åŸèŠ‚ç‚¹ random->next
        if (curr->random != NULL) {
            copyNode->random = curr->random->next;
        } else {
            copyNode->random = NULL;
        }
        // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªåŸå§‹èŠ‚ç‚¹ï¼ˆè·³è¿‡å¤åˆ¶èŠ‚ç‚¹ï¼‰
        curr = copyNode->next;
    }

    // ç¬¬ä¸‰æ­¥ï¼šåˆ†ç¦»åŸå§‹é“¾è¡¨å’Œå¤åˆ¶é“¾è¡¨
    curr = head;
    // å¤åˆ¶é“¾è¡¨çš„å¤´èŠ‚ç‚¹
    struct Node* copyHead = head->next;
    struct Node* copyCurr = copyHead;

    while (curr != NULL) {
        // æ¢å¤åŸå§‹é“¾è¡¨çš„ next æŒ‡é’ˆ
        curr->next = curr->next->next;
        
        // è®¾ç½®å¤åˆ¶é“¾è¡¨çš„ next æŒ‡é’ˆ
        if (copyCurr->next != NULL) {
            copyCurr->next = copyCurr->next->next;
        }
        
        // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
        curr = curr->next;
        copyCurr = copyCurr->next;
    }

    // è¿”å›å¤åˆ¶é“¾è¡¨çš„å¤´èŠ‚ç‚¹
    return copyHead;
}
```

### ğŸ“– æ€»ç»“ï¼š

<details>
<summary>ç‚¹å‡»å±•å¼€é¢˜ç›®æ€»ç»“</summary>
# ğŸ¤” éšæœºé“¾è¡¨çš„å¤åˆ¶

---

## 1ï¸âƒ£ é¢˜ç›®æ ¸å¿ƒä¿¡æ¯

ğŸ¯ **åŠŸèƒ½æè¿°**ï¼šå®ç°å¸¦æœ‰éšæœºæŒ‡é’ˆçš„é“¾è¡¨çš„æ·±æ‹·è´ï¼Œåˆ›å»ºä¸€ä¸ªä¸åŸé“¾è¡¨ç»“æ„å®Œå…¨ç›¸åŒä½†èŠ‚ç‚¹å…¨æ–°çš„é“¾è¡¨

ğŸ“¥ **è¾“å…¥è¾“å‡º**ï¼š
- **è¾“å…¥**ï¼š`head` - åŸå§‹é“¾è¡¨çš„å¤´èŠ‚ç‚¹æŒ‡é’ˆ
- **è¾“å‡º**ï¼šæ–°çš„é“¾è¡¨å¤´èŠ‚ç‚¹æŒ‡é’ˆï¼Œå…¶ç»“æ„ä¸åŸé“¾è¡¨å®Œå…¨ç›¸åŒä½†æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯æ–°åˆ›å»ºçš„

---

## 2ï¸âƒ£ å®ç°åŸç†

ğŸ’¡ **æ ¸å¿ƒæ€è·¯**ï¼šé€šè¿‡ä¸‰æ¬¡éå†åŸé“¾è¡¨ï¼Œåœ¨åŸé“¾è¡¨ä¸­ç›´æ¥æ„å»ºæ˜ å°„å…³ç³»ï¼Œé¿å…ä½¿ç”¨é¢å¤–çš„å“ˆå¸Œè¡¨å­˜å‚¨ç©ºé—´

ğŸ“‹ **å®ç°æ­¥éª¤**ï¼š
1. å¤åˆ¶æ¯ä¸ªèŠ‚ç‚¹å¹¶æ’å…¥åˆ°åŸèŠ‚ç‚¹ä¹‹åï¼Œæ„å»ºäº¤æ›¿é“¾è¡¨ç»“æ„
2. æ ¹æ®åŸèŠ‚ç‚¹çš„randomæŒ‡é’ˆè®¾ç½®å¤åˆ¶èŠ‚ç‚¹çš„randomæŒ‡é’ˆ
3. åˆ†ç¦»åŸå§‹é“¾è¡¨å’Œå¤åˆ¶é“¾è¡¨ï¼Œæ¢å¤åŸé“¾è¡¨å¹¶æ„å»ºæ–°é“¾è¡¨

---

## 3ï¸âƒ£ å…³é”®ç‚¹è§£æ

è¯¥è§£æ³•é€šè¿‡å·§å¦™åœ°å°†å¤åˆ¶èŠ‚ç‚¹æ’å…¥åˆ°åŸèŠ‚ç‚¹ä¹‹åï¼Œåˆ©ç”¨ä½ç½®å…³ç³»å»ºç«‹åŸèŠ‚ç‚¹ä¸å¤åˆ¶èŠ‚ç‚¹çš„æ˜ å°„ï¼Œé¿å…äº†ä½¿ç”¨å“ˆå¸Œè¡¨ã€‚

### ğŸ¯ ä»£ç æŠ€å·§
- èŠ‚ç‚¹äº¤ç»‡æŠ€æœ¯ï¼šå°†å¤åˆ¶èŠ‚ç‚¹æ’å…¥åŸèŠ‚ç‚¹ä¹‹åï¼Œåˆ©ç”¨ä½ç½®å…³ç³»å»ºç«‹æ˜ å°„
- ä¸‰æ­¥åˆ†ç¦»æ³•ï¼šå…ˆå¤åˆ¶èŠ‚ç‚¹ï¼Œå†è®¾ç½®randomæŒ‡é’ˆï¼Œæœ€ååˆ†ç¦»é“¾è¡¨
- è¾¹ç•Œå¤„ç†ï¼šæ­£ç¡®å¤„ç†NULLæŒ‡é’ˆå’Œé“¾è¡¨å°¾éƒ¨èŠ‚ç‚¹

## 4ï¸âƒ£ ä½¿ç”¨åœºæ™¯

### âœ… é€‚ç”¨æƒ…å†µï¼š
- éœ€è¦å®ç°å¤æ‚é“¾è¡¨çš„æ·±æ‹·è´
- å†…å­˜ä½¿ç”¨è¦æ±‚ä¸¥æ ¼ï¼Œä¸èƒ½ä½¿ç”¨é¢å¤–çš„å“ˆå¸Œè¡¨ç©ºé—´
- é“¾è¡¨æ“ä½œä¸­éœ€è¦ä¿æŒèŠ‚ç‚¹é—´å¤æ‚å¼•ç”¨å…³ç³»çš„åœºæ™¯

### âš ï¸ å‰ææ¡ä»¶ï¼š
- é“¾è¡¨èŠ‚ç‚¹ç»“æ„å·²çŸ¥ä¸”å›ºå®š
- èŠ‚ç‚¹çš„randomæŒ‡é’ˆå¯èƒ½æŒ‡å‘ä»»æ„èŠ‚ç‚¹æˆ–NULL
- å…è®¸ä¿®æ”¹åŸé“¾è¡¨ç»“æ„ï¼ˆä¸´æ—¶ï¼‰

## 5ï¸âƒ£ å¤æ‚åº¦åˆ†æ

- â±ï¸ æ—¶é—´å¤æ‚åº¦ï¼šO(n) - éœ€è¦éå†é“¾è¡¨ä¸‰æ¬¡ï¼Œæ¯æ¬¡éå†éƒ½æ˜¯çº¿æ€§æ—¶é—´
- ğŸ’¾ ç©ºé—´å¤æ‚åº¦ï¼šO(1) - åªä½¿ç”¨äº†å¸¸æ•°çº§åˆ«çš„é¢å¤–ç©ºé—´ï¼ˆä¸è®¡ç®—ç»“æœé“¾è¡¨æœ¬èº«ï¼‰

## 6ï¸âƒ£ æ³¨æ„äº‹é¡¹

### ğŸš© è¾¹ç•Œæƒ…å†µï¼š
- è¾“å…¥é“¾è¡¨ä¸ºç©ºçš„æƒ…å†µ
- èŠ‚ç‚¹çš„randomæŒ‡é’ˆæŒ‡å‘NULLçš„æƒ…å†µ
- é“¾è¡¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æƒ…å†µ

### ğŸ’¥ æ˜“é”™ç‚¹ï¼š
- åœ¨åˆ†ç¦»é“¾è¡¨æ—¶å¿˜è®°æ¢å¤åŸé“¾è¡¨çš„ç»“æ„
- randomæŒ‡é’ˆä¸ºNULLæ—¶çš„ç‰¹æ®Šå¤„ç†
- éå†è¿‡ç¨‹ä¸­æŒ‡é’ˆç§»åŠ¨çš„æ­¥é•¿æ§åˆ¶é”™è¯¯

## 7ï¸âƒ£ è¡¥å……è¯´æ˜
è¿™ä¸ª `copyRandomList` å‡½æ•°å®ç°äº†å¯¹å¸¦æœ‰éšæœºæŒ‡é’ˆçš„é“¾è¡¨è¿›è¡Œæ·±æ‹·è´ã€‚å®ƒé‡‡ç”¨äº†"åŸåœ°å¤åˆ¶"çš„æŠ€å·§ï¼Œåˆ†ä¸‰æ­¥å®Œæˆï¼š

1. äº¤ç»‡å¤åˆ¶èŠ‚ç‚¹ï¼šåœ¨æ¯ä¸ªåŸèŠ‚ç‚¹åæ’å…¥å…¶å‰¯æœ¬
2. è®¾ç½®éšæœºæŒ‡é’ˆï¼šåˆ©ç”¨äº¤ç»‡ç»“æ„è®¾ç½®å‰¯æœ¬èŠ‚ç‚¹çš„ random æŒ‡é’ˆ
3. åˆ†ç¦»é“¾è¡¨ï¼šå°†åŸé“¾è¡¨å’Œå‰¯æœ¬é“¾è¡¨åˆ†ç¦»
#### ç¤ºä¾‹æ¼”ç¤º
æˆ‘ä»¬ä»¥ç¤ºä¾‹ `[[1,1],[2,1]]` ä¸ºä¾‹ï¼Œå³é“¾è¡¨æœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼š

- èŠ‚ç‚¹1 (å€¼ä¸º1)ï¼ŒrandomæŒ‡å‘èŠ‚ç‚¹2
- èŠ‚ç‚¹2 (å€¼ä¸º2)ï¼ŒrandomæŒ‡å‘èŠ‚ç‚¹2è‡ªèº«
#### åˆå§‹çŠ¶æ€
```
åŸé“¾è¡¨: 1(random->2) -> 2(random->2) -> NULL
```
#### ç¬¬ä¸€æ­¥ï¼šäº¤ç»‡å¤åˆ¶èŠ‚ç‚¹
```c
// åˆ›å»ºæ¯ä¸ªèŠ‚ç‚¹çš„å‰¯æœ¬å¹¶æ’å…¥å…¶å
struct Node* curr = head;
while (curr != NULL) {
    struct Node* newNode = (struct Node*)malloc(sizeof(struct Node));
    newNode->val = curr->val;
    newNode->next = curr->next;
    curr->next = newNode;
    curr = newNode->next;
}
```
æ‰§è¡ŒåçŠ¶æ€ï¼š
```
äº¤ç»‡é“¾è¡¨: 1(random->2) -> 1'(random->?) -> 2(random->2) -> 2'(random->?) -> NULL
```
#### ç¬¬äºŒæ­¥ï¼šè®¾ç½®å‰¯æœ¬èŠ‚ç‚¹çš„ random æŒ‡é’ˆ
```c
// è®¾ç½®å¤åˆ¶èŠ‚ç‚¹çš„ random æŒ‡é’ˆ
curr = head;
while (curr != NULL) {
    struct Node* copyNode = curr->next;
    if (curr->random != NULL) {
        copyNode->random = curr->random->next;  // å…³é”®ï¼šåˆ©ç”¨äº¤ç»‡ç»“æ„
    } else {
        copyNode->random = NULL;
    }
    curr = copyNode->next;
}
```
æ‰§è¡Œè¿‡ç¨‹ï¼š

1. å¤„ç†èŠ‚ç‚¹1ï¼š`1->random` æŒ‡å‘èŠ‚ç‚¹2ï¼Œæ‰€ä»¥ `1'->random` åº”è¯¥æŒ‡å‘èŠ‚ç‚¹2çš„å‰¯æœ¬ï¼Œå³ `2->next` (ä¹Ÿå°±æ˜¯2')

2. å¤„ç†èŠ‚ç‚¹2ï¼š`2->random` æŒ‡å‘èŠ‚ç‚¹2è‡ªèº«ï¼Œæ‰€ä»¥ `2'->random` åº”è¯¥æŒ‡å‘èŠ‚ç‚¹2çš„å‰¯æœ¬ï¼Œå³ `2->next` (ä¹Ÿå°±æ˜¯2')

æ‰§è¡ŒåçŠ¶æ€ï¼š
```
äº¤ç»‡é“¾è¡¨: 1(random->2) -> 1'(random->2') -> 2(random->2) -> 2'(random->2') -> NULL
```
#### ç¬¬ä¸‰æ­¥ï¼šåˆ†ç¦»ä¸¤ä¸ªé“¾è¡¨
```c
// åˆ†ç¦»åŸå§‹é“¾è¡¨å’Œå¤åˆ¶é“¾è¡¨
curr = head;
struct Node* copyHead = head->next;  // æ–°é“¾è¡¨çš„å¤´èŠ‚ç‚¹
struct Node* copyCurr = copyHead;

while (curr != NULL) {
    curr->next = curr->next->next;       // æ¢å¤åŸé“¾è¡¨
    if (copyCurr->next != NULL) {
        copyCurr->next = copyCurr->next->next;  // æ„å»ºæ–°é“¾è¡¨
    }
    curr = curr->next;
    copyCurr = copyCurr->next;
}
```
æ‰§è¡Œè¿‡ç¨‹ï¼š

1. æ¢å¤åŸé“¾è¡¨1çš„nextæŒ‡é’ˆï¼š1->next = 1->next->next å³ 1->next = 2
2. è®¾ç½®æ–°é“¾è¡¨1'çš„nextæŒ‡é’ˆï¼š1'->next = 1'->next->next å³ 1'->next = 2'
3. ç»§ç»­å¤„ç†èŠ‚ç‚¹2ï¼ŒåŒç†æ¢å¤å’Œè®¾ç½®æŒ‡é’ˆ

æœ€ç»ˆç»“æœï¼š
```
åŸé“¾è¡¨:   1(random->2)  -> 2(random->2)  -> NULL
æ–°é“¾è¡¨:   1'(random->2') -> 2'(random->2') -> NULL
```
å‡½æ•°è¿”å›æ–°é“¾è¡¨çš„å¤´èŠ‚ç‚¹ `1'`ã€‚

è¿™ä¸ªç®—æ³•çš„å·§å¦™ä¹‹å¤„åœ¨äºåˆ©ç”¨èŠ‚ç‚¹äº¤ç»‡çš„æ–¹å¼ï¼Œåœ¨ä¸ä½¿ç”¨é¢å¤–å­˜å‚¨ç©ºé—´çš„æƒ…å†µä¸‹å»ºç«‹äº†åŸèŠ‚ç‚¹ä¸æ–°èŠ‚ç‚¹ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œä»è€Œèƒ½å¤Ÿæ­£ç¡®è®¾ç½®randomæŒ‡é’ˆã€‚
</details>
