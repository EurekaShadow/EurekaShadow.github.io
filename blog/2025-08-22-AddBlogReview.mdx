---
slug: AddBlogReview
title: æ·»åŠ åšå®¢è¯„è®º
authors: eurekaX
tags: [åšå®¢]
---

import { Highlight, Keyword, Light, B1, B2, B3, BH3, B3W, MyColor} from '@site/src/components/ForMDX';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CardImg from '@site/src/components/CardImg';

### <B2>åœ¨ Docusaurus çš„åšå®¢ä¸­æ·»åŠ  giscus è¯„è®ºğŸ¤”</B2>

<!-- truncate -->


## å®‰è£…ä¾èµ–

<Tabs>

  <TabItem value="npm" label="npm">
```bash
npm install --save @giscus/react
```
  </TabItem>

  <TabItem value="yarn" label="yarn">
```bash
yarn add @giscus/react
```
  </TabItem>

  <TabItem value="pnpm" label="pnpm">
```bash
pnpm add @giscus/react
```
  </TabItem>  
 
</Tabs>




## åˆ›å»ºè¯„è®ºç»„ä»¶
```tsx title="src/components/Comment.tsx"
import React, { useEffect, useState } from 'react'
import BrowserOnly from '@docusaurus/BrowserOnly'

export default function Comment(): JSX.Element {
  return (
    <div style={{ marginTop: '2rem' }}>
      <BrowserOnly fallback={<div style={{ minHeight: '200px' }}>åŠ è½½è¯„è®ºä¸­...</div>}>
        {() => {
          const { useThemeConfig } = require('@docusaurus/theme-common')
          const { useLocation } = require('@docusaurus/router')
          const Giscus = require('@giscus/react').default
          
          const themeConfig = useThemeConfig()
          const location = useLocation()

          // ä¿®æ”¹é¡µé¢ç±»å‹æ£€æŸ¥ï¼Œé€‚é…ä½ çš„åšå®¢è·¯å¾„æ ¼å¼
          // æ£€æŸ¥æ˜¯å¦ä¸ºåšå®¢æ–‡ç« é¡µé¢ï¼š/blog/æ–‡ç« æ ‡é¢˜
          const isBlogPostPage = /^\/blog\/[^/]+$/.test(location.pathname) || 
                                (/^\/blog\//.test(location.pathname) && !/^\/blog\/?$/.test(location.pathname) && location.pathname.split('/').length === 3);
          
          const isDocPage = location.pathname.startsWith('/docs/');
          
          // è°ƒè¯•ä¿¡æ¯ï¼Œå¯ä»¥å¸®åŠ©ä½ ç¡®è®¤è·¯å¾„åŒ¹é…
          console.log('Current path:', location.pathname);
          console.log('Is blog post page:', isBlogPostPage);
          console.log('Is doc page:', isDocPage);
          
          // å¦‚æœä¸æ˜¯åšå®¢æ–‡ç« é¡µé¢æˆ–æ–‡æ¡£é¡µé¢ï¼Œä¸æ˜¾ç¤ºè¯„è®º
          if (!isBlogPostPage && !isDocPage) {
            return <div></div>; // è¿”å›ç©ºå†…å®¹ï¼Œä¸æ˜¾ç¤ºè¯„è®º
          }

          const giscus: any = { ...themeConfig.giscus }

          if (!giscus.repo || !giscus.repoId || !giscus.categoryId) {
            return (
              <div style={{ padding: '1rem', textAlign: 'center', color: 'red' }}>
                è¯„è®ºç³»ç»Ÿé…ç½®ç¼ºå¤±
              </div>
            )
          }

          // å¤„ç†è·¯å¾„
          const path = location.pathname.replace(/^\/|\/$/g, '');
          const subPath = path || "index";
          giscus.term = subPath;

          // ä¸»é¢˜ç›‘å¬ç»„ä»¶
          const GiscusWithThemeListener = () => {
            const [theme, setTheme] = useState('light');

            useEffect(() => {
              const updateTheme = () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                setTheme(currentTheme === 'dark' ? 'transparent_dark' : 'light');
              };

              // åˆå§‹åŒ–
              updateTheme();

              // ç›‘å¬ä¸»é¢˜å˜åŒ–
              const observer = new MutationObserver(() => {
                updateTheme();
              });

              observer.observe(document.documentElement, {
                attributes: true,
                attributeFilter: ['data-theme']
              });

              return () => observer.disconnect();
            }, []);

            return <Giscus {...giscus} theme={theme} />;
          };

          return <GiscusWithThemeListener />;
        }}
      </BrowserOnly>
    </div>
  )
}
```

:::info[ç‰¹åˆ«è¯´æ˜]

ä¸Šé¢ Comment.tsxä¸­çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ˜¯ï¼š

- âœ… `/blog/FirstBlog`
- âœ… `/blog/ä»»ä½•å•ä¸ªè·¯å¾„æ®µ`
- âŒ `/blog/`(åšå®¢åˆ—è¡¨é¡µ)
- âŒ `/blog/category/subcategory`(å¤šçº§è·¯å¾„)

:::

## åšå®¢é¡µé¢å¯ç”¨è¯„è®º
åšå®¢é¡µé¢ç”± `docusaurus` çš„ `BlogPostItem` ç»„ä»¶æ¸²æŸ“ï¼Œä¸‹é¢æ˜¯è‡ªå®šä¹‰æ–¹æ³•ã€‚

1. swizzle `BlogPostItem `ï¼š
<Tabs>

  <TabItem value="npm" label="npm">
```bash
npm run swizzle @docusaurus/theme-classic BlogPostItem -- --wrap --typescript
```
  </TabItem>

  <TabItem value="yarn" label="yarn">
```bash
yarn swizzle @docusaurus/theme-classic BlogPostItem --wrap --typescript
```
  </TabItem>

  <TabItem value="pnpm" label="pnpm">
```bash
pnpm run swizzle @docusaurus/theme-classic BlogPostItem -- --wrap --typescript
```
  </TabItem>  
 
</Tabs>

å‡ºç°è­¦æŠ¥è¯´ä¸å®‰å…¨ä»€ä¹ˆçš„ï¼Œç›´æ¥

>YES: I know what I am doing!


2. ç„¶ååœ¨ `BlogPostItem` çš„ `index.tsx` é‡Œé¢ï¼Œå°†å…¶**å…¨éƒ¨æ›¿æ¢**ä¸ºä¸‹åˆ—çš„ä»£ç ï¼š
```tsx title="src/theme/BlogPostItem/index.tsx"
import React from 'react';
import BlogPostItem from '@theme-original/BlogPostItem';
import type { WrapperProps } from '@docusaurus/types';
import Comment from '@site/src/components/Comment';

type Props = WrapperProps<typeof BlogPostItem>;

export default function BlogPostItemWrapper(props: Props): JSX.Element {
  const { children, ...otherProps } = props;
  
  return (
    <BlogPostItem {...otherProps}>
      {children}
      <div className="blog-post-comments" style={{ 
        marginTop: '2rem',
        paddingTop: '1.5rem',
        borderTop: '1px solid var(--ifm-color-emphasis-300)'
      }}>
        <Comment />
      </div>
    </BlogPostItem>
  );
}
```

## é…ç½®giscus

[giscuså®˜ç½‘](https://giscus.app/zh-CN)

<p><CardImg src="/img/Blog/giscuscongf1.jpg" alt="è¯„è®ºåŠŸèƒ½æ·»åŠ æˆåŠŸ" isCenter={true} /></p>

æ‰€è°“çš„ `Discussions` åŠŸèƒ½æ˜¯æŒ‡è¿™é‡Œï¼š`Github->Settings->General`

<p><CardImg src="/img/Blog/giscuscongf5.jpg" alt="è¯„è®ºåŠŸèƒ½æ·»åŠ æˆåŠŸ" isCenter={true} /></p>

ä¸‰ä¸ªæ¡ä»¶éƒ½æ»¡è¶³æ—¶ï¼Œè¾“å…¥ï¼š`ç”¨æˆ·å/ä»“åº“å`ï¼Œgiscusæç¤ºä»“åº“æ»¡è¶³æ¡ä»¶æ—¶ï¼Œå¯ä»¥æ­£å¼å¼€å§‹é…ç½®

1. åˆ†ç±»é€‰ `General`ï¼›ç‰¹æ€§ç¬¬ä¸€ä¸ªé»˜è®¤é€‰ï¼Œæœ€åä¸¤ä¸ªå¯é€‰å¯ä¸é€‰ï¼ˆå³ä½¿ä¸é€‰åç»­ä¹Ÿå¯ä»¥ç»§ç»­é…ç½®ï¼‰

<p><CardImg src="/img/Blog/giscuscongf2.jpg" alt="è¯„è®ºåŠŸèƒ½æ·»åŠ æˆåŠŸ" isCenter={true} /></p>

2. è¿™å››ä¸ªä¿¡æ¯ï¼š

<p><CardImg src="/img/Blog/giscuscongf3.jpg" alt="è¯„è®ºåŠŸèƒ½æ·»åŠ æˆåŠŸ" isCenter={true} /></p>

3. ä¾æ¬¡å¡«å…¥åˆ°ï¼š `docusaurus.config.js` çš„è¿™ä¸ªä½ç½®

<p><CardImg src="/img/Blog/giscuscongf4.jpg" alt="è¯„è®ºåŠŸèƒ½æ·»åŠ æˆåŠŸ" isCenter={true} /></p>

```js title="docusaurus.config.js"
// æ·»åŠ  giscus è¯„è®ºåŠŸèƒ½
giscus: {
	repo: 'username/username.github.io',
	repoId: '********',
	category: 'General',
	categoryId: '********',
	lang: 'zh-CN', // ä¸­æ–‡è¯„è®ºæ¨¡å—
	inputPosition: 'top',//è¡¨ç¤ºè¾“å…¥æ¡†åœ¨è¯„è®ºåŒºé¡¶éƒ¨
},
```

4. æœ€åï¼Œ`yarn start`

å¤§åŠŸå‘Šæˆï¼è¿™æ—¶å°±ä¼šçœ‹åˆ°å·²ç»å‡ºç°è¯„è®ºäº†ï¼š

<p><CardImg src="/img/Blog/BlogReview.jpg" alt="è¯„è®ºåŠŸèƒ½æ·»åŠ æˆåŠŸ" isCenter={true} /></p>

æƒ³è¦ç»™ `æ–‡æ¡£é¡µé¢` ä¹Ÿæ·»åŠ è¿™æ ·çš„è¯„è®ºåŠŸèƒ½ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡[æ–‡ç« ](https://imroc.cc/note/docusaurus/giscus)ã€‚

## ğŸ“š å‚è€ƒèµ„æ–™

[æ·»åŠ  giscus è¯„è®ºåŠŸèƒ½](https://imroc.cc/note/docusaurus/giscus)











